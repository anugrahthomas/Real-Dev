ðŸ”¥ EVENT LOOP â€” INTERNAL PHASE ARCHITECTURE

ðŸ§  The Real Node Event Loop Cycle
ðŸ‘‰ Each loop iteration = one tick
Each tick runs phases in this order:
1. Timers
2. Pending Callbacks
3. Idle / Prepare
4. Poll
5. Check
6. Close Callbacks

NOTE: Microtasks (Promises, process.nextTick) run after each phase, before the next phase starts.

1. Timers (timer phase):
â€¢ setTimeout, setInterval callbacks executed here.
2. Pending Callbacks:
â€¢ I/O callbacks (e.g. TCP errors, DNS lookup callbacks) executed here.
3. Idle / Prepare:
â€¢ Internal phase for libuv, not directly accessible.
4. Poll:(This is the heart of Node)
â€¢ Handles I/O events, executes I/O callbacks, and waits for new I/O events.
5. Check:
â€¢ setImmediate callbacks executed here, cleanup events.
6. Close Callbacks:
â€¢ Handles close events like socket.on('close', callback) executed here.
NOTE: check phase runs after poll phase, so setImmediate callbacks run after I/O events are processed.

ðŸ”¬ Microtasks (Critical Detail)
After:
- Every callback execution
- Every phase transition
Node drains:
- process.nextTick queue
- Promise microtask queue


ðŸ§  Visual Flow
Timers: setTimeout, setInterval
â†“
Microtasks: process.nextTick, Promise.then
â†“
Pending: I/O callbacks
â†“
Microtasks
â†“
Poll: I/O events, I/O callbacks
â†“
Microtasks
â†“
Check: setImmediate
â†“
Microtasks
â†“
Close: socket.on('close')
â†“
Microtasks
(Loop repeats)

NOTE: inside I/O callbacks, setImmediate runs first.

MicroTask Starving:
when a long running microtask keeps the event loop from moving to the next phase, causing delays in I/O processing. Avoid this by keeping microtasks short and efficient.
eg: 
function loop() {
  Promise.resolve().then(loop);
}
loop();
setTimeout(() => {
  console.log("This will never run due to microtask starving");
}, 0);
longRunningMicrotask();



ðŸ§  Event Loop & HTTP Server

When request arrives:
1. OS notifies libuv
2. Poll phase receives event
3. Callback executed
4. Microtasks drained(e.g. Promise.then)
5. Loop continues

ðŸ§  Architecture knowledge
| Operation      | Runs Where      | Blocks?   |
| -------------- | --------------- | --------- |
| HTTP I/O       | OS + libuv      | No        |
| File read      | Thread pool     | No        |
| JSON.parse     | Main thread     | YES       |
| Infinite loop  | Main thread     | YES       |
| Promise chain  | Microtask queue | Can block |
| bcrypt (async) | Thread pool     | No        |
| Heavy for-loop | Main thread     | YES       |
